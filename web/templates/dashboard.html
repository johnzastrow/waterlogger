<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <h1>Waterlogger</h1>
            </div>
            <div class="navbar-menu">
                <a href="/" class="navbar-item">Dashboard</a>
                <a href="/pools" class="navbar-item">Pools</a>
                <a href="/kits" class="navbar-item">Test Kits</a>
                <a href="/samples" class="navbar-item">Samples</a>
                <a href="/charts" class="navbar-item">Charts</a>
                <a href="/export" class="navbar-item">Export</a>
                <a href="/settings" class="navbar-item">Settings</a>
                <a href="#" class="navbar-item" onclick="logout()">Logout</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <script src="/static/js/debug.js"></script>
        <div class="dashboard-container" x-data="dashboard()">
    <div class="dashboard-header">
        <h2>üè† Dashboard</h2>
        <p>Welcome to your water management system</p>
    </div>

    <div class="dashboard-grid">
        <div class="dashboard-card">
            <h3>Recent Samples</h3>
            <div class="card-content">
                <template x-for="sample in recentSamples" :key="sample.id">
                    <div class="sample-item">
                        <div class="sample-info">
                            <span class="sample-pool" x-text="sample.pool?.name || 'Unknown Pool'"></span>
                            <span class="sample-date" x-text="formatDate(sample.sample_datetime)"></span>
                        </div>
                        <div class="sample-values">
                            <span>pH: <span x-text="sample.measurements?.ph || 'N/A'"></span></span>
                            <span>FC: <span x-text="sample.measurements?.fc || 'N/A'"></span> ppm</span>
                        </div>
                    </div>
                </template>
                <div x-show="recentSamples.length === 0" class="empty-state">
                    No samples yet. <a href="/samples">Add your first sample</a>
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>Pool Status</h3>
            <div class="card-content">
                <template x-for="pool in pools" :key="pool.id">
                    <div class="pool-item">
                        <div class="pool-info">
                            <span class="pool-name" x-text="pool.name"></span>
                            <span class="pool-type" x-text="pool.type || 'Pool'"></span>
                        </div>
                        <div class="pool-volume" x-show="pool.volume_gallons">
                            <span x-text="pool.volume_gallons"></span> gallons
                        </div>
                    </div>
                </template>
                <div x-show="pools.length === 0" class="empty-state">
                    No pools configured. <a href="/pools">Add a pool</a>
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>Quick Actions</h3>
            <div class="card-content">
                <div class="quick-actions">
                    <a href="/samples" class="action-btn">
                        <span>üìä</span>
                        <span>Add Sample</span>
                    </a>
                    <a href="/pools" class="action-btn">
                        <span>üèä</span>
                        <span>Manage Pools</span>
                    </a>
                    <a href="/charts" class="action-btn">
                        <span>üìà</span>
                        <span>View Charts</span>
                    </a>
                    <a href="/export" class="action-btn">
                        <span>üìÅ</span>
                        <span>Export Data</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>Water Quality Summary</h3>
            <div class="card-content">
                <div class="quality-indicators">
                    <div class="indicator">
                        <span class="indicator-label">pH Balance</span>
                        <span class="indicator-value" x-text="qualityStatus.ph"></span>
                    </div>
                    <div class="indicator">
                        <span class="indicator-label">Chlorine Level</span>
                        <span class="indicator-value" x-text="qualityStatus.chlorine"></span>
                    </div>
                    <div class="indicator">
                        <span class="indicator-label">Alkalinity</span>
                        <span class="indicator-value" x-text="qualityStatus.alkalinity"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function dashboard() {
        return {
            pools: [],
            recentSamples: [],
            qualityStatus: {
                ph: 'Good',
                chlorine: 'Good',
                alkalinity: 'Good'
            },
            
            async init() {
                await this.loadPools();
                await this.loadRecentSamples();
            },
            
            async loadPools() {
                const result = await WaterloggerHelpers.loadData('/api/pools', 'pools');
                if (result.success) {
                    this.pools = result.data;
                }
            },
            
            async loadRecentSamples() {
                const result = await WaterloggerHelpers.loadData('/api/samples?limit=5', 'recent samples');
                if (result.success) {
                    this.recentSamples = result.data;
                }
            },
            
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
            }
        };
    }
</script>
    </main>

    <script>
        async function logout() {
            try {
                const response = await fetch('/api/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Logout failed:', error);
            }
        }
    </script>
</body>
</html>